name: Deploy to Render
on:
  workflow_run:
    workflows:
      - Docker Build
    types:
      - completed

jobs:
  on-success:
    runs-on: ubuntu-latest
    deploy:
      if: ${{ github.event.workflow_run.conclusion == 'success' }}
      name: Wait for Deploy
      runs-on: ubuntu-latest
      steps:
        - name: Wait for Render Deployment
          uses: bounceapp/render-action@0.6.0
          with:
            render-token: ${{ secrets.RENDER_TOKEN }}
            github-token: ${{ secrets.GITHUB_TOKEN }}
            service-id: srv-cg4nhi02qv287cq05a90
            retries: 20
            wait: 16000
  on-failure:
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion == 'failure' }}
    steps:
      - name: Abruptly end the workflow
        run: exit 1
